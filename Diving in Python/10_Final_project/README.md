# Система для сбора и хранения метрик, основанная на клиент-серверной архитектуре

## **1. Введение**
В крупных проектах, с большим количеством пользователей, необходимо тщательно наблюдать за всеми процессами. Информация об этих процессах может быть представлена различными численными показателями, называемыми метриками. В рамках данного проекта будет реализована система, обеспечивающая сбор и хранение метрик.

## **2. Протокол взаимодействия**
Клиент и сервер взаимодействуют между собой по простому текстовому протоколу через TCP сокеты. Текстовый протокол имеет главное преимущество – наглядность, можно просматривать диалог взаимодействия клиентской и серверной стороны без использования дополнительных инструментов.

## **3. Формат запроса**
Общий формат клиентского запроса выглядит следующим образом: 
```
<команда> <данные запроса><\n>
```
Где `<команда>` - это команда сервера (команда может принимать одно из двух значений: put — сохранить данные на сервере, get — вернуть сохраненные данные с сервера)

## **4. Формат ответа**
Общий формат ответа с сервера выглядит следующим образом: 
```
<статус ответа><\n>
<данные ответа><\n>
<\n>
```
Где `<статус ответа>` - это статус выполнения команды, допустимы два варианта: «ok» - команда успешно выполнена на сервере и «error» - выполнение команды завершилось ошибкой
## **5. Данные**
Для каждой метрики `<key>` мы будем хранить данные о ее значениях `<value>` и времени, когда производилось измерение `<timestamp>`. 
Именование метрики имеет следующий вид:
```
<название сервера>.<название данных>
```
Таким образом на сервере по каждому ключу будет сохранятся список данных конкретных измерений (пара: значение, время измерения).
## **6. Примеры запросов и ответов** <a name="examples"></a>
Рассмотрим пример отправки на сервер данных для сохранения. Пусть у нас имеются данные измерений - загрузка процессора «cpu» на сервере "palm" во время 1150864247 была равна 23.7 процента. Строка запроса в этом случае будет иметь вид:
```
put palm.cpu 23.7 1150864247\n
```
Чтобы получить с сервера данные, сохраненные по ключу «palm.cpu», необходимо в данных запроса просто передать имя ключа:
```
get palm.cpu\n
```
Для случая, когда необходимо получить все хранимые на сервере данные, в качестве ключа используется символ звездочки «*». Пример строки запроса:
```
get *\n
```
Пример ответа сервера:
```
ok\n
palm.cpu 2.0 1150864247\n
palm.cpu 0.5 1150864248\n
eardrum.cpu 3.0 1150864250\n
\n
```
В случае передачи несуществующего ключа при запросе get и успешного сохранения данных при запросе put выводится следующее сообщение от сервера:
```
ok\n
\n
``` 
Если в параметре запроса переданы не валидные данные (например: нарушен формат запроса, ошибочная команда или значения value и timestamp не могут быть приведены к необходимому типу данных) сервер отправляет строку со статусом ответа «error» и данными ответа «wrong command»:  
```
error\n
wrong command\n
\n
```
## **6. Серверная часть**
- Сервер хранит информацию от клиентов в своей собственной структуре.
- Сервер умеет обрабатывать запросы от нескольких клиентов одновременно.
- Сервер умеет обрабатывать некорректные запросы.
## **7. Стек**
- Python 3.9.5
- socket, asyncio, time, argparse
## **8. Запуск на Windows10**
1. Скачиваем файлы **BaseSocket**, **Client**, **Server** в одну папку
2. Открываем в этой папке командную строку
3. Для создания сервера в командной строке вводим:
   
   ```
   python Server.py --host адрес --port порт
   ```
   Например:

   ```
   python Server.py --host localhost --port 10001
   ```
   В созданной командной строке будет отображаться лог сервера
4. Открываем в той же папке еще одну командную строку
5. Для создания клиента в командной строке вводим:
   
   ```
   python Client.py --host адрес --port порт
   ```
   Например:

   ```
   python Client.py --host localhost --port 10001
   ```
   В этой командной строке можно вводить запросы
6. Теперь можно вводить запросы в командной строке для клиента и получать ответы от сервера. [Примеры запросов и ответов](#examples)
7. Более короткий вариант запуска позволяет не указывать порт и адрес, в этом случае они устанавливаются по умолчанию: localhost, 10001
